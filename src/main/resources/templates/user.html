<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>User page</title>
</head>

<body>
<header>
    <nav class="navbar navbar-dark bg-dark p-0 shadow">
        <div class="nav-item text-left text-white px-3">
            <span class="fw-bold" id="userEmail"></span>
            <span>with roles:</span>
            <span id="userRoles"></span>
        </div>
        <ul class="navbar-nav mr-3">
            <li class="nav-item text-nowrap">
                <a class="nav-link px-3" href="/logout">Logout</a>
            </li>
        </ul>
    </nav>
</header>

<div class="container-fluid mt-3 ">
    <div class="row">
        <div class="col-md-2 px-0 ">
            <div class="d-flex flex-column flex-shrink-0 p-0 text-white">
                <ul class="nav nav-pills flex-column">
                    <li class="nav-item">
                        <a href="#" data-bs-toggle="pill" class="nav-link active no-refresh" role="tab"
                           aria-current="false">User</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="col-md-10 bg-light">
            <div class="tab-content">
                <div class="tab-pane fade show active" id="userInfo" role="tabpanel">
                    <div class="container-fluid">
                        <h2>User information-page</h2>
                        <div class="card">
                            <div class="container-fluid px-0 bg-light border">
                                <h5 class="card-header">About user</h5>
                            </div>

                            <div class="container-fluid mt-4">
                                <div class="table-responsive">
                                    <table class="table table-striped bg-white">
                                        <thead>
                                        <tr>
                                            <th scope="col" class="small"><b>ID</b></th>
                                            <th scope="col" class="small"><b>FirstName</b></th>
                                            <th scope="col" class="small"><b>LastName</b></th>
                                            <th scope="col" class="small"><b>Age</b></th>
                                            <th scope="col" class="small"><b>Email</b></th>
                                            <th scope="col" class="small"><b>Role</b></th>
                                        </tr>
                                        </thead>
                                        <tbody id="userInfoTable">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
        document.addEventListener("DOMContentLoaded", function() {
            fetch('/api/user')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(user => {
                    document.getElementById('userEmail').textContent = user.email;
                    document.getElementById('userRoles').textContent = user.roles.map(role => role.authority.substring(5)).join(', ');

                    const userInfoTable = document.getElementById('userInfoTable');
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.firstName}</td>
                        <td>${user.lastName}</td>
                        <td>${user.age}</td>
                        <td>${user.email}</td>
                        <td>${user.roles.map(role => role.authority.substring(5)).join(', ')}</td>
                    `;
                    userInfoTable.appendChild(row);
                })
                .catch(error => console.error('There was a problem with the fetch operation:', error));
        });
    </script>
</body>
</html>